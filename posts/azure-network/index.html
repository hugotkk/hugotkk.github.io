<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Azure Networking &#183; Hugo's IT journal</title><meta name=title content="Azure Networking &#183; Hugo's IT journal"><meta name=description content="Explore an IT enthusiast's personal journal sharing insights on DevOps, AWS, Kubernetes, Docker, and more - learn, grow, and stay updated in the tech world."><link rel=canonical href=https://hugotkk.github.com/posts/azure-network/><link type=text/css rel=stylesheet href=/css/main.bundle.min.063a9f97d19633e479cdf057a8a0cbf6b8ddd636f69e9bbc434359ffe7fa53e07c889c4429a3c207ad89557949bdc06598a56842c1855fa7578b4db2f26304be.css integrity="sha512-Bjqfl9GWM+R5zfBXqKDL9rjd1jb2npu8Q0NZ/+f6U+B8iJxEKaPCB62JVXlJvcBlmKVoQsGFX6dXi02y8mMEvg=="><script type=text/javascript src=/js/main.min.cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e.js integrity="sha512-z4PhNX7vuL3xVChQ1m2AB9Yg5AULVxXcg/SpIdNs6c5H0NE8XYXysP+DGNKHfuwvY7kxvUdBeoGlODJ6+SfaPg=="></script>
<script type=text/javascript src=/js/appearance.min.f94f4c4636d9e3ec8f5ee53cdc8ffa3d01bf87cd92ac85e6797550b1e2b80dc9118d838f3eb24c55109352455e72ff082dfe560283154e5a8f87fd75107b59c4.js integrity="sha512-+U9MRjbZ4+yPXuU83I/6PQG/h82SrIXmeXVQseK4DckRjYOPPrJMVRCTUkVecv8ILf5WAoMVTlqPh/11EHtZxA=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.3ddcf04f5b0d4c32f72e726d3c12eebccd8c3c9f9daa9a13414808895de0ae1e1cdddda6849680d5bd96dbb60d0b1e0b24c29f5c83e5631e55e7e6bc02015490.js integrity="sha512-PdzwT1sNTDL3LnJtPBLuvM2MPJ+dqpoTQUgIiV3grh4c3d2mhJaA1b2W27YNCx4LJMKfXIPlYx5V5+a8AgFUkA==" data-copy data-copied></script>
<script src=/js/zoom.min.js></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Azure Networking"><meta property="og:description" content="Network Interface> Network Interface # A single NIC can have multiple public and private IPs. Network Security Group (NSG)> Network Security Group (NSG) # NSG is stateful and contains inbound and outbound rules."><meta property="og:type" content="article"><meta property="og:url" content="https://hugotkk.github.com/posts/azure-network/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-03T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-06T02:06:28+01:00"><meta property="og:site_name" content="Hugo's IT journal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Azure Networking"><meta name=twitter:description content="Network Interface> Network Interface # A single NIC can have multiple public and private IPs. Network Security Group (NSG)> Network Security Group (NSG) # NSG is stateful and contains inbound and outbound rules."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Azure Networking","headline":"Azure Networking","abstract":"Network Interface\u003e Network Interface # A single NIC can have multiple public and private IPs. Network Security Group (NSG)\u003e Network Security Group (NSG) # NSG is stateful and contains inbound and outbound rules.","inLanguage":"en","url":"https:\/\/hugotkk.github.com\/posts\/azure-network\/","author":{"@type":"Person","name":"Hugo"},"copyrightYear":"2024","dateCreated":"2024-07-03T00:00:00\u002b00:00","datePublished":"2024-07-03T00:00:00\u002b00:00","dateModified":"2024-07-06T02:06:28\u002b01:00","keywords":["azure","networking"],"mainEntityOfPage":"true","wordCount":"2602"}]</script><meta name=author content="Hugo"><link href=https://github.com/hugotkk rel=me><link href=https://linkedin.com/in/hugotkk rel=me><script async src="https://www.googletagmanager.com/gtag/js?id=G-V270QWW7TE"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-V270QWW7TE",{anonymize_ip:!1})}</script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div style=padding-left:0;padding-right:0 class="flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div><a href=/ class=flex><span class=sr-only>Hugo&rsquo;s IT journal</span>
<img src=/image.jpg width=230 height=230 class="max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="Hugo's IT journal"></a></div><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">Hugo&rsquo;s IT journal</a></nav><div class="hidden md:flex items-center space-x-5 md:ml-12"><a href=/posts/ class="text-base font-medium text-gray-500 hover:text-gray-900" title=Posts>posts</a>
<a href=/tags/ class="text-base font-medium text-gray-500 hover:text-gray-900" title=Tags>tags</a>
<a href=/tags/k8s/ class="text-base font-medium text-gray-500 hover:text-gray-900" title=k8s>k8s</a>
<a href=/tags/openstack/ class="text-base font-medium text-gray-500 hover:text-gray-900" title=openstack>openstack</a>
<a href=/tags/aws/ class="text-base font-medium text-gray-500 hover:text-gray-900" title=aws>aws</a>
<a href=/tags/rancher/ class="text-base font-medium text-gray-500 hover:text-gray-900" title=rancher>rancher</a>
<a href=/tags/docker/ class="text-base font-medium text-gray-500 hover:text-gray-900" title=docker>docker</a>
<button id=search-button class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></div><div class="flex md:hidden items-center space-x-5 md:ml-12"><span></span>
<button id=search-button-mobile class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:25px class="fixed inset-0 z-30 invisible w-screen h-screen m-auto overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex movedown flex-col w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl sm:px-14 md:px-24 lg:px-32 sm:py-10 sm:pt-10"><li class=mb-1><span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/posts/ title=Posts><span class="inline-block align-text-bottom"></span>posts</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags><span class="inline-block align-text-bottom"></span>tags</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/k8s/ title=k8s><span class="inline-block align-text-bottom"></span>k8s</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/openstack/ title=openstack><span class="inline-block align-text-bottom"></span>openstack</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/aws/ title=aws><span class="inline-block align-text-bottom"></span>aws</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/rancher/ title=rancher><span class="inline-block align-text-bottom"></span>rancher</a></li><li class=mb-1><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/docker/ title=docker><span class="inline-block align-text-bottom"></span>docker</a></li></ul></div></label></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Azure Networking</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2024-07-03 00:00:00 +0000 UTC">2024-07-03</time><span class="px-2 text-primary-500">&#183;</span><time datetime="2024-07-06 02:06:28 +0100 +0100">Updated: 2024-07-06</time></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/azure/")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">azure</span></span></span>
<span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/networking/")'><span class=flex><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">networking</span></span></span></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first sm:max-w-prose lg:ml-auto px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#network-interface>Network Interface</a></li><li><a href=#network-security-group-nsg>Network Security Group (NSG)</a></li><li><a href=#route-table>Route Table</a></li><li><a href=#subnet>Subnet</a></li><li><a href=#diagnose--monitor-tools>Diagnose & Monitor Tools</a><ul><li><a href=#diagnose-nsg-issue>Diagnose NSG issue</a></li><li><a href=#diagnose-connectivity-issue>Diagnose Connectivity issue</a></li><li><a href=#connection-monitor>Connection monitor</a></li><li><a href=#flow-log>Flow Log</a></li><li><a href=#private-link-in-azure-monitor>Private Link in Azure Monitor</a></li><li><a href=#metrics--insight-in-azure-monitor>Metrics / Insight in Azure Monitor</a></li><li><a href=#monitoring-agents-overview>Monitoring Agents Overview</a></li></ul></li><li><a href=#alerts>Alerts</a><ul><li><a href=#itsm-integration>ITSM Integration</a></li><li><a href=#alert-rate-limits>Alert Rate Limits</a></li><li><a href=#administrative-operations-alerts>Administrative Operations Alerts</a></li><li><a href=#suppressed-notifications>Suppressed Notifications</a></li><li><a href=#alert-components>Alert Components</a></li><li><a href=#user-response-states>User Response States</a></li></ul></li><li><a href=#app-service>App Service</a></li><li><a href=#azure-load-balancer>Azure Load Balancer</a><ul><li><a href=#nsg>NSG</a></li><li><a href=#nat-rules>NAT Rules</a></li><li><a href=#floating-ip>Floating IP</a></li><li><a href=#ha-port>HA Port</a></li><li><a href=#session-persistence>Session Persistence</a></li></ul></li><li><a href=#vm>VM</a></li><li><a href=#bastion>Bastion</a></li><li><a href=#expressroute>Expressroute</a></li><li><a href=#vnet-peering>VNET Peering</a></li><li><a href=#firewall>Firewall</a></li><li><a href=#service-endpoint>Service Endpoint</a></li><li><a href=#virtualwan>VirtualWAN</a></li><li><a href=#vpn>VPN</a><ul><li><a href=#s2s-vpn>S2S VPN</a></li><li><a href=#p2s-vpn>P2S VPN</a><ul><li><a href=#when-to-use>When to Use</a></li><li><a href=#authentication>Authentication</a></li><li><a href=#common-issue>Common issue</a></li></ul></li><li><a href=#vpn-types>VPN Types</a></li></ul></li><li><a href=#dns>DNS</a><ul><li><a href=#custom-domains>Custom Domains</a></li><li><a href=#zone-migration>Zone Migration</a></li><li><a href=#private-dns-zones>Private DNS Zones</a></li><li><a href=#custom-dns-server>Custom DNS Server</a></li></ul></li></ul></nav></div></details><details class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#network-interface>Network Interface</a></li><li><a href=#network-security-group-nsg>Network Security Group (NSG)</a></li><li><a href=#route-table>Route Table</a></li><li><a href=#subnet>Subnet</a></li><li><a href=#diagnose--monitor-tools>Diagnose & Monitor Tools</a><ul><li><a href=#diagnose-nsg-issue>Diagnose NSG issue</a></li><li><a href=#diagnose-connectivity-issue>Diagnose Connectivity issue</a></li><li><a href=#connection-monitor>Connection monitor</a></li><li><a href=#flow-log>Flow Log</a></li><li><a href=#private-link-in-azure-monitor>Private Link in Azure Monitor</a></li><li><a href=#metrics--insight-in-azure-monitor>Metrics / Insight in Azure Monitor</a></li><li><a href=#monitoring-agents-overview>Monitoring Agents Overview</a></li></ul></li><li><a href=#alerts>Alerts</a><ul><li><a href=#itsm-integration>ITSM Integration</a></li><li><a href=#alert-rate-limits>Alert Rate Limits</a></li><li><a href=#administrative-operations-alerts>Administrative Operations Alerts</a></li><li><a href=#suppressed-notifications>Suppressed Notifications</a></li><li><a href=#alert-components>Alert Components</a></li><li><a href=#user-response-states>User Response States</a></li></ul></li><li><a href=#app-service>App Service</a></li><li><a href=#azure-load-balancer>Azure Load Balancer</a><ul><li><a href=#nsg>NSG</a></li><li><a href=#nat-rules>NAT Rules</a></li><li><a href=#floating-ip>Floating IP</a></li><li><a href=#ha-port>HA Port</a></li><li><a href=#session-persistence>Session Persistence</a></li></ul></li><li><a href=#vm>VM</a></li><li><a href=#bastion>Bastion</a></li><li><a href=#expressroute>Expressroute</a></li><li><a href=#vnet-peering>VNET Peering</a></li><li><a href=#firewall>Firewall</a></li><li><a href=#service-endpoint>Service Endpoint</a></li><li><a href=#virtualwan>VirtualWAN</a></li><li><a href=#vpn>VPN</a><ul><li><a href=#s2s-vpn>S2S VPN</a></li><li><a href=#p2s-vpn>P2S VPN</a><ul><li><a href=#when-to-use>When to Use</a></li><li><a href=#authentication>Authentication</a></li><li><a href=#common-issue>Common issue</a></li></ul></li><li><a href=#vpn-types>VPN Types</a></li></ul></li><li><a href=#dns>DNS</a><ul><li><a href=#custom-domains>Custom Domains</a></li><li><a href=#zone-migration>Zone Migration</a></li><li><a href=#private-dns-zones>Private DNS Zones</a></li><li><a href=#custom-dns-server>Custom DNS Server</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><div id=network-interface class=anchor>Network Interface></div><h2 class="relative group">Network Interface
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#network-interface aria-label=Anchor>#</a></span></h2><ul><li>A single NIC can have multiple public and private IPs.</li></ul><div id=network-security-group-nsg class=anchor>Network Security Group (NSG)></div><h2 class="relative group">Network Security Group (NSG)
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#network-security-group-nsg aria-label=Anchor>#</a></span></h2><p>NSG is stateful and contains <code>inbound</code> and <code>outbound</code> rules.</p><p>Service Tags are named groups that refer to Azure services (e.g., AzurePortal, AzureLoadBalancer).</p><p>An NSG can be attached to:</p><ul><li>Subnets</li><li>Network Interfaces</li></ul><p>Order of NSG rules check:</p><ul><li>Inbound: Subnet > NIC</li><li>Outbound: NIC > Subnet</li></ul><p>A single NSG can be attached to multiple subnets or network interfaces.</p><p>By default, NSG allows:</p><ul><li>All traffic within the VNET.</li><li>Traffic from the load balancer.</li></ul><p>Additional points:</p><ul><li>Once traffic is denied, it is dropped.</li><li>If NSG is attached to both subnet and NIC, traffic must be allowed in both NSGs.</li><li>NSG must be in the same region as the VNET.</li></ul><p>To Check NSG for SSH Connectivity (e.g., Can VM1 SSH into VM2?)</p><ol><li>Identify Source and Destination:<ul><li>VM1 is the source.</li><li>VM2 is the destination.</li></ul></li><li>Check NSG Rules:<ul><li>For the source (VM1), look at the outbound rules.</li><li>For the destination (VM2), look at the inbound rules.</li></ul></li></ol><div id=route-table class=anchor>Route Table></div><h2 class="relative group">Route Table
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#route-table aria-label=Anchor>#</a></span></h2><p>Imagine we have VNETs A, B, and C that are peered together. VNET C acts as a network VNET to firewall, guard, and audit the network traffic. We want any egress public traffic from VNETs A and B to route through VNET C first.</p><p>To achieve this, we can add a route rule in the route tables of VNETs A and B with the address prefix <code>0.0.0.0/0</code>, next hop type set to <code>appliance</code>, and the next hop address set to the <code>appliance's address</code>.</p><p>If we want to route all VPN traffic through VNET C, we can set a route table rule at the <code>GatewaySubnet</code>.</p><div id=subnet class=anchor>Subnet></div><h2 class="relative group">Subnet
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#subnet aria-label=Anchor>#</a></span></h2><p>A subnet can have multiple address spaces, and additional address spaces can be added after the subnet has been created.</p><p>Azure reserves the first four IP addresses in each subnet.</p><div id=diagnose--monitor-tools class=anchor>Diagnose & Monitor Tools></div><h2 class="relative group">Diagnose & Monitor Tools
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#diagnose--monitor-tools aria-label=Anchor>#</a></span></h2><div id=diagnose-nsg-issue class=anchor>Diagnose NSG issue></div><h3 class="relative group">Diagnose NSG issue
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#diagnose-nsg-issue aria-label=Anchor>#</a></span></h3><ul><li>IP Flow Verify (VM)</li><li>NSG Diagnostics (ScaleSet, NIC, Application Gateway)</li></ul><div id=diagnose-connectivity-issue class=anchor>Diagnose Connectivity issue></div><h3 class="relative group">Diagnose Connectivity issue
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#diagnose-connectivity-issue aria-label=Anchor>#</a></span></h3><ul><li>Connection Troubleshoot (VMs, Bastion, and Application Gateway)</li></ul><div id=connection-monitor class=anchor>Connection monitor></div><h3 class="relative group">Connection monitor
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#connection-monitor aria-label=Anchor>#</a></span></h3><p>Connection Monitor is a regional service available in each Azure region.</p><p>It continuously checks connections over time.</p><p>To utilize Connection Monitor:</p><ul><li><strong>Azure VMs</strong>: Install the Network Watcher Agent.</li><li><strong>On-premises</strong>: Install the Azure Monitor Agent. Additionally, use the Azure Connected Machine agent to connect the VMs on Azure.</li></ul><p>This setup allows for proactive monitoring of connections, ensuring continuous visibility and troubleshooting capabilities across Azure environments and on-premises infrastructure.</p><div id=flow-log class=anchor>Flow Log></div><h3 class="relative group">Flow Log
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#flow-log aria-label=Anchor>#</a></span></h3><p>Enabling Flow Log requires</p><ul><li>Storage Account</li><li>Register Insight Provider (At Subscription)</li></ul><p>Enabling Traffic Analytics requires</p><ul><li>Flow Log</li><li>Log Analytics Workspace</li></ul><div id=private-link-in-azure-monitor class=anchor>Private Link in Azure Monitor></div><h3 class="relative group">Private Link in Azure Monitor
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#private-link-in-azure-monitor aria-label=Anchor>#</a></span></h3><p>&ldquo;Monitor Private Link Scope&rdquo; refers to a collection of private links.</p><p>To use a private connection in Azure Monitor, it is necessary to establish private link connections because Azure Monitor integrates with various services. The &ldquo;Monitor Private Link Scope&rdquo; is essential for this purpose.</p><div id=metrics--insight-in-azure-monitor class=anchor>Metrics / Insight in Azure Monitor></div><h3 class="relative group">Metrics / Insight in Azure Monitor
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#metrics--insight-in-azure-monitor aria-label=Anchor>#</a></span></h3><p>Azure Monitor is similar to AWS CloudWatch.</p><p>To setup the monitoring, we need to</p><ul><li>Install Azure Monitor Agent for collect metrics and logs.</li><li>Setup Data Collection Rule (DCR) to send metrics and logs from the agent to Log Analytics Workspaces.</li></ul><p>Components of a DCR:</p><ul><li><strong>Resources:</strong> Specify VMs from which to collect data.</li><li><strong>Data Sources:</strong> Include Performance Data, Syslog, and Event Logs gathered by the agent.</li><li><strong>Destination:</strong> Log Analytics Workspace.</li></ul><p>Notice that:</p><ul><li>One DCR can collect data from multiple VMs</li><li>One VM can contribute data to multiple DCRs</li></ul><p>This setup allows centralized management and analysis of metrics and logs from Azure VMs using Azure Monitor and Log Analytics Workspaces.</p><p><strong>Legacy Way will use Log Analytics:</strong></p><ol><li>Create a Log Analytics workspace.</li><li>Install the Log Analytics agent.</li><li>Under the Log Analytics workspace, configure performance counters.</li></ol><div id=monitoring-agents-overview class=anchor>Monitoring Agents Overview></div><h3 class="relative group">Monitoring Agents Overview
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#monitoring-agents-overview aria-label=Anchor>#</a></span></h3><p><strong>Monitor Agent:</strong></p><ul><li>Capable of sending logs and metrics to multiple Log Analytics Workspaces.</li><li>Recommended as a replacement for other agents.</li><li>Does not support custom logs or IIS logs.</li></ul><p><strong>Windows/Linux Diagnostics Agent:</strong></p><ul><li>Found in the <code>Diagnostics</code> tab.</li><li>Can send logs and metrics to multiple destinations such as Log Analytics Workspaces, Storage Accounts, and Event Hubs.</li><li>Provides more robust functionality compared to Monitor Agent.</li></ul><p>Both agents support metrics and logs and are designed for use with VMs.</p><p><strong>Log Analytics Agent:</strong></p><ul><li>Supports sending logs only.</li><li>Configuration is decentralized (needs to be configured on the VM itself).</li><li>Can be used outside of Azure environments.</li></ul><div id=alerts class=anchor>Alerts></div><h2 class="relative group">Alerts
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#alerts aria-label=Anchor>#</a></span></h2><div id=itsm-integration class=anchor>ITSM Integration></div><h3 class="relative group">ITSM Integration
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#itsm-integration aria-label=Anchor>#</a></span></h3><p>One of the alert destinations is send the alert to ITSM via IT Service Management Connector.</p><p>But this will be retired in 2025. Currently, it can only be created via API.</p><div id=alert-rate-limits class=anchor>Alert Rate Limits></div><h3 class="relative group">Alert Rate Limits
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#alert-rate-limits aria-label=Anchor>#</a></span></h3><ul><li><strong>SMS/Voice Call:</strong> Every 5 minutes.</li><li><strong>Email:</strong> Less than 100 per hour.</li></ul><p>Emails will only be sent to individual users, not to groups or service principals.</p><div id=administrative-operations-alerts class=anchor>Administrative Operations Alerts></div><h3 class="relative group">Administrative Operations Alerts
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#administrative-operations-alerts aria-label=Anchor>#</a></span></h3><p>You can configure alerts for administrative operations logged in Azure Activity, which essentially covers any API call. Examples include:</p><ul><li>Writing a tag to resource and VM</li><li>Creating a disk</li><li>Attaching a disk to VM</li></ul><p>In the activity log, these operations are identified by <code>"eventSource": "Administrative"</code>.</p><div id=suppressed-notifications class=anchor>Suppressed Notifications></div><h3 class="relative group">Suppressed Notifications
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#suppressed-notifications aria-label=Anchor>#</a></span></h3><p>When an alert processing rule suppresses notifications, the alert will still be listed in the portal, but no notification will be sent.</p><div id=alert-components class=anchor>Alert Components></div><h3 class="relative group">Alert Components
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#alert-components aria-label=Anchor>#</a></span></h3><ul><li><strong>Resource (Scope):</strong> The subscription or resource the alert pertains to.</li><li><strong>Condition (Signal):</strong> The source of data and the threshold that triggers the alert.</li><li><strong>Signal Source:</strong> Typically a Log Analytics Workspace.</li><li><strong>Action Group:</strong> Defines the notifications and actions to be taken when the alert is triggered.</li></ul><div id=user-response-states class=anchor>User Response States></div><h3 class="relative group">User Response States
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#user-response-states aria-label=Anchor>#</a></span></h3><ul><li>If the user response is &ldquo;New&rdquo;, it can be changed to &ldquo;Acknowledged&rdquo; or &ldquo;Closed.&rdquo;</li><li>If the user response is &ldquo;Closed&rdquo;, it cannot be changed.</li></ul><div id=app-service class=anchor>App Service></div><h2 class="relative group">App Service
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#app-service aria-label=Anchor>#</a></span></h2><p>Integrating with a VNET provides egress connectivity to the VNET.</p><p>App Service will be assigned a private IP, which it uses to access services within the VNET.</p><p>However, this assignment is dynamic and can change during scaling operations.</p><p>Inbound traffic and internet traffic will still use the public IP.</p><p>NSGs / Firewall can be utilized to control the App Service traffic flow into the VNET.</p><div id=azure-load-balancer class=anchor>Azure Load Balancer></div><h2 class="relative group">Azure Load Balancer
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#azure-load-balancer aria-label=Anchor>#</a></span></h2><p>The SKU of the Load Balancer must match that of the public IP:</p><ul><li>Standard public IP addresses must be used with Standard Load Balancers.</li><li>Basic public IP addresses are compatible only with scale sets or availability sets.</li></ul><p>To create the load balancer, a <code>frontend IP</code> is required.</p><p>To set up the load balancing rule, a <code>backend pool</code> and a <code>health probe</code> need to be configured.</p><p>The load balancer and VMs need to be in the same VNET.</p><div id=nsg class=anchor>NSG></div><h3 class="relative group">NSG
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#nsg aria-label=Anchor>#</a></span></h3><p>Traffic originating from the LB always appears to come from 168.63.129.16.</p><p>When VMs are behind the LB, NSG rules must explicitly specify the source as 168.63.129.16 to allow traffic.</p><p>By default, traffic from 168.63.129.16 (Serivce Tag: AzureLoadBalancer) is allowed, so NSG rules are typically used to deny traffic.</p><div id=nat-rules class=anchor>NAT Rules></div><h3 class="relative group">NAT Rules
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#nat-rules aria-label=Anchor>#</a></span></h3><p>Load Balancer are used for distributing traffic. Interestingly, in Azure, they can also act as a NAT.</p><p><strong>Inbound NAT Rule:</strong></p><ul><li>Allows the outside network to reach the backend point or VMs behind the backend pool</li><li>To connect to VM1 and VM2 via the Load Balancer on same port, we need 2 frontend IPs:<ul><li><code>&lt;frontend_ip1>:8080 -> VM1:8080</code></li><li><code>&lt;frontend_ip2>:8080 -> VM2:8080</code></li></ul></li><li>Frontend IPs can be mapped to a backend pool using a single frontend IP, where the frontend IP starts with a base port that increments for each mapping:<ul><li><code>&lt;frontend_ip1>:8081 -> VM1:8080</code></li><li><code>&lt;frontend_ip1>:8082 -> VM2:8080</code></li><li><code>&lt;frontend_ip1>:X -> VMX:8080</code></li></ul></li></ul><p><strong>Outbound Rules:</strong></p><ul><li>Multiple VMs in the backend pool can share a single frontend IP for outbound traffic.</li></ul><div id=floating-ip class=anchor>Floating IP></div><h3 class="relative group">Floating IP
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#floating-ip aria-label=Anchor>#</a></span></h3><ul><li><strong>Disabled:</strong> Traffic routes through the load balancer to the VM&rsquo;s IP.</li><li><strong>Enabled:</strong> Traffic routes through the load balancer to the VM&rsquo;s Floating IP (FIP).</li></ul><p>In an on-premise Active-Passive HA setup, a VIP is typically used, to which clients always connect. Monitoring tools check server health and shift the VIP between active and passive instances. The VM will respond to ARP requests for the VIP when it holds it.</p><p>In the cloud, ARP and other broadcast messages are not permitted, necessitating the use of a load balancer.</p><p>To set up a Floating IP in Linux:</p><ul><li>Basically, create a loopback interface with the Floating IP.</li></ul><p>This setup is commonly used to achieve High Availability in SQL Server, where a Floating IP is needed for direct server return.</p><div id=ha-port class=anchor>HA Port></div><h3 class="relative group">HA Port
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ha-port aria-label=Anchor>#</a></span></h3><p>Configuration: Set port to 0 and protocol to all in the load balancing rule. This directs all ports and protocols to the VM directly</p><p>Due to this, each floating IP can only have 1 load balancer rule and connect to 1 backend.</p><p>This feature is for:</p><ul><li><strong>Internal Load Balancer</strong> only</li><li><strong>Standard tier</strong> only</li></ul><p><strong>Use Case: Virtual Appliance (eg: Firewall):</strong></p><ul><li>Configure two floating IPs and HA ports on the virtual appliance to tag traffic from different services.</li><li>HA port is also required to inspect traffic for any protocol and any port.</li><li>Floating IP is necessary for HA and to distinguish the traffic from different service, such as:<ul><li>Route all Web Server subnet traffic to FIP1.</li><li>Route all DB subnet traffic to FIP2.</li></ul></li><li>Requests are first forwarded to the virtual appliance (acting as a man in the middle) before being sent to the destination.</li></ul><div id=session-persistence class=anchor>Session Persistence></div><h3 class="relative group">Session Persistence
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#session-persistence aria-label=Anchor>#</a></span></h3><p>Session Persistence based on Client IP ensures that traffic from the same client is always served by the same VM.</p><div id=vm class=anchor>VM></div><h2 class="relative group">VM
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#vm aria-label=Anchor>#</a></span></h2><p>A VM without a public IP can still access the internet.</p><p>For a VM with standard public IP:</p><ul><li>Security settings enforce blocking all traffic by default. You must attach a NSG to allow traffic into the VM.</li></ul><p>For a VM with basic public IP:</p><ul><li>The VM is accessible publicly without needing an NSG attached.</li></ul><p>A VM can change its subnet or NIC but not its VNET. To change the VNET or move the VM to another region, we need to recreate the VM.</p><div id=bastion class=anchor>Bastion></div><h2 class="relative group">Bastion
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#bastion aria-label=Anchor>#</a></span></h2><ul><li><p>Bastion must be deployed to a subnet named AzureBastionSubnet.</p></li><li><p>The subnet must be /26 or larger.</p></li><li><p>Bastion protects VMs only.</p></li><li><p>Basic SKU:</p><ul><li>Creates 2 instances.</li></ul></li><li><p>Standard SKU:</p><ul><li>Allows specifying the number of instances (host scaling).</li><li>Supports file upload/download.</li><li>Supports native client (use Azure CLI for SSH/RDP connections).</li></ul></li></ul><p>Public IP requirements:</p><ul><li>Can be regional or global (to be confirmed).</li><li>Must be static.</li><li>Requires Standard SKU.</li></ul><p>Without the native client, we can only use Bastion through the Azure portal.</p><p>Each instance supports up to 20 RDP or 40 SSH connections.</p><p>For example, with 100 concurrent SSH connections, we need 3 instances, which means we need the Standard Bastion SKU and host scaling set to 3.</p><p>Resizing the subnet is unnecessary since we only need additional instances.</p><div id=expressroute class=anchor>Expressroute></div><h2 class="relative group">Expressroute
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#expressroute aria-label=Anchor>#</a></span></h2><ul><li>The Basic SKU does not support the coexistence of VPN Gateway and ExpressRoute.</li><li>The ErGw3Az SKU supports FastPath.</li></ul><div id=vnet-peering class=anchor>VNET Peering></div><h2 class="relative group">VNET Peering
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#vnet-peering aria-label=Anchor>#</a></span></h2><p>With VNET Peering, the VNET address spaces must not overlap.</p><p>When peering is disconnected, we need to recreate the peering connections.</p><p>When transit routing is enabled in a VNET, traffic can transit through it to reach other VNETs.</p><p>For example, if we have VNET1, VNET2, and VNET3:</p><ul><li>Initially, VNET1 cannot access VNET3.</li><li>If transit routing is enabled in VNET2, VNET1 can access VNET3 through VNET2.</li></ul><p>One key difference between S2S VPN and VNET Peering is that VNET Peering does not require creating an extra GatewaySubnet to connect two VNETs.</p><div id=firewall class=anchor>Firewall></div><h2 class="relative group">Firewall
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#firewall aria-label=Anchor>#</a></span></h2><p>Firewall Premium supports public IP with:</p><ul><li>Standard SKU</li><li>Global & Regional? (to be confirmed)</li><li>IPv4 Only</li></ul><p>The region of the firewall should be the same as the region of the VNET.</p><p>In App Service, to control outbound traffic with a firewall, we need to enable VNET integration and then create a user-defined route table to route all traffic to the firewall.</p><div id=service-endpoint class=anchor>Service Endpoint></div><h2 class="relative group">Service Endpoint
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#service-endpoint aria-label=Anchor>#</a></span></h2><p>Service Endpoints use private IP addresses to access Azure services, simplifying access control with ACLs.</p><p>VNET and Service Endpoint must be in the same region.</p><p>It is in the Subnet level.</p><div id=virtualwan class=anchor>VirtualWAN></div><h2 class="relative group">VirtualWAN
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#virtualwan aria-label=Anchor>#</a></span></h2><p>Virtual WAN (similar to AWS Transit Gateway) is a global resource that can span across regions, while Virtual Hubs are regional resources.</p><p>A single Virtual WAN can connect to multiple Virtual Hubs.</p><p>To create a S2S VPN between a branch and a VNET:</p><ol><li>Create a Virtual WAN.</li><li>Create a Virtual Hub.</li><li>Create a VPN site in the Virtual Hub.</li><li>Connect the VPN site to the Hub.</li><li>Connect the VNET to the Hub.</li></ol><div id=vpn class=anchor>VPN></div><h2 class="relative group">VPN
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#vpn aria-label=Anchor>#</a></span></h2><div id=s2s-vpn class=anchor>S2S VPN></div><h3 class="relative group">S2S VPN
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#s2s-vpn aria-label=Anchor>#</a></span></h3><p>The Basic SKU VPN Gateway does not support coexistence with ExpressRoute for S2S VPN.</p><p><strong>Steps to Create a S2S VPN</strong></p><ol><li>Create a gateway subnet.</li><li>Create a VPN gateway.</li><li>Create a local gateway (representing the on-premise site).</li><li>Create a VPN connection.</li></ol><p>Each VPN gateway can support 2 connections, requiring 2 local gateways (for 2 on-premise routers) and using up 2 public IP addresses for the gateway.</p><ul><li><strong>IKEv2</strong> supports up to 10 S2S connections.</li><li><strong>IKEv1</strong> supports only 1 S2S connection.</li></ul><p>IKEv2 is necessary if redundancy is required.</p><div id=p2s-vpn class=anchor>P2S VPN></div><h3 class="relative group">P2S VPN
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#p2s-vpn aria-label=Anchor>#</a></span></h3><div id=when-to-use class=anchor>When to Use></div><h4 class="relative group">When to Use
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#when-to-use aria-label=Anchor>#</a></span></h4><ul><li><strong>P2S VPN:</strong> Suitable for remote workers, as the IP addresses connecting to the VNET can vary.</li><li><strong>S2S VPN:</strong> Suitable for branch offices, connecting on-premise networks to the VNET with fixed IPs.</li></ul><div id=authentication class=anchor>Authentication></div><h4 class="relative group">Authentication
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#authentication aria-label=Anchor>#</a></span></h4><p>P2S VPN can authenticate using</p><ul><li>certificate authentication</li><li>Active Directory</li></ul><p><strong>To setup Certificate Authentication:</strong></p><ol><li>Generate a CA and client certifcate.</li><li>Upload the CA public key to the P2S VPN Setting.</li><li>Connect to the VPN using client certifcate.</li></ol><div id=common-issue class=anchor>Common issue></div><h4 class="relative group">Common issue
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#common-issue aria-label=Anchor>#</a></span></h4><ol><li>The on-premise network is connected to VNET A via a S2S VPN.</li><li>Clients connect to VNET A using a P2S VPN.</li><li>VNET A is peered with VNET B.</li></ol><p>P2S VPN clients may fail to access VNET B when the network topology changes, necessitating a reinstall or restart of the VPN client.</p><p>In this setup, the client cannot access VNET B, while the on-premise network can, indicating this issue.</p><div id=vpn-types class=anchor>VPN Types></div><h3 class="relative group">VPN Types
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#vpn-types aria-label=Anchor>#</a></span></h3><ul><li><strong>Route-based VPN:</strong> Used for large networks; uses a route table.</li><li><strong>Policy-based VPN:</strong> Used for small networks; uses ACLs, requiring specific source and destination addresses.</li></ul><p>Since usually P2S VPN clients do not have fixed IPs, it is difficult to use ACLs (as the source cannot be specified). Therefore, route-based VPN is usually used for P2S VPNs.
Certainly! Here&rsquo;s a rewritten version:</p><div id=dns class=anchor>DNS></div><h2 class="relative group">DNS
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#dns aria-label=Anchor>#</a></span></h2><p>DNS settings can be configured at the</p><ul><li>VNET</li><li>NIC</li></ul><div id=custom-domains class=anchor>Custom Domains></div><h3 class="relative group">Custom Domains
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#custom-domains aria-label=Anchor>#</a></span></h3><ol><li>Update NS records at your domain registrar.</li><li>Verify domain ownership using a TXT record.</li><li>Configure your custom domain with a CNAME or A record.</li></ol><div id=zone-migration class=anchor>Zone Migration></div><h3 class="relative group">Zone Migration
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#zone-migration aria-label=Anchor>#</a></span></h3><p>Azure offers PowerShell scripts to facilitate DNS zone migration, useful for transitioning from on-premises or other cloud providers.</p><div id=private-dns-zones class=anchor>Private DNS Zones></div><h3 class="relative group">Private DNS Zones
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#private-dns-zones aria-label=Anchor>#</a></span></h3><ul><li>Private DNS zones are necessary for connecting with Virtual Networks (VNETs).</li><li>One DNS zone can be connected to multiple VNETs, and multiple resolution zones can be linked to a single VNET.</li><li>Auto-registration automated the creation of DNS records for linked VNETs.</li><li>Auto-registration is only supported within private DNS zones.</li><li>Each VNET can designate one registration zone with auto-registration enabled.</li></ul><div id=custom-dns-server class=anchor>Custom DNS Server></div><h3 class="relative group">Custom DNS Server
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#custom-dns-server aria-label=Anchor>#</a></span></h3><ul><li>Virtual Machines (VMs) can function as custom DNS servers.</li><li>Each VNET can opt for Azure DNS or a custom DNS setup.</li><li>Ensure connectivity to the VM when using it as a DNS server.</li></ul></br></br></div><script>var oid="views_posts/azure-network.md",oid_likes="likes_posts/azure-network.md"</script><script type=text/javascript src=/js/page.min.0e49973b4ad0a382c7c6012d8bff8226316642daabc4f8a20477bd08674f3da6e2fa993bc20ad4f51e7c5bb68e6f913a207a7c4fe37ea0e7b806894afce0a64e.js integrity="sha512-DkmXO0rQo4LHxgEti/+CJjFmQtqrxPiiBHe9CGdPPabi+pk7wgrU9R58W7aOb5E6IHp8T+N+oOe4BolK/OCmTg=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=flex><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt=Hugo src=/image_hu41af6bbe385ae76f287135953fab8786_14628_192x192_fill_q75_box_smart1.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Hugo</div><div class="text-sm text-neutral-700 dark:text-neutral-400">DevOps Engineer based in London</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/hugotkk target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://linkedin.com/in/hugotkk target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></span></a></div></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/azure-acl/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Azure ACL</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2024-06-29 00:00:00 +0000 UTC">2024-06-29</time></span></span></a></span>
<span><a class="flex text-right group ml-3" href=/posts/azure-resource-group/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Azure Resource Group</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2024-07-06 00:00:00 +0000 UTC">2024-07-06</time></span></span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><div id=disqus_thread></div><script>(function(){var e=document,t=e.createElement("script");t.src="https://hugotkk-github-io.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></footer></article></main><footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/posts/ title=Posts>Articles</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>Tags</a></li></ul></nav><div class="flex items-center justify-between"></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.2166d3adac1679c00a75161830ab5725d3efc0e3d3f8c2453fb01d0907948436c25f0f8a7ad824322fa22f3f9c85fd4d0a1d5c856f53b862157da25a57dc3d52.js integrity="sha512-IWbTrawWecAKdRYYMKtXJdPvwOPT+MJFP7AdCQeUhDbCXw+KetgkMi+iLz+chf1NCh1chW9TuGIVfaJaV9w9Ug=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://hugotkk.github.com/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>