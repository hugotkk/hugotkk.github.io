<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Azure Networking &#183; Hugo's IT journal</title><meta name=title content="Azure Networking &#183; Hugo's IT journal"><meta name=description content="Explore an IT enthusiast's personal journal sharing insights on DevOps, AWS, Kubernetes, Docker, and more - learn, grow, and stay updated in the tech world."><meta name=keywords content="azure,networking,"><link rel=canonical href=https://hugotkk.github.com/posts/azure-network/><link type=text/css rel=stylesheet href=/css/main.bundle.min.85f006de1806b55b2d082d1122deedd8cec6fdc1f7c8a51be975a4496165d6c798f4a3de52545a6a87cc4bc09fc2d6f5201d44ea57acc1ac2b1c42a688c62bee.css integrity="sha512-hfAG3hgGtVstCC0RIt7t2M7G/cH3yKUb6XWkSWFl1seY9KPeUlRaaofMS8Cfwtb1IB1E6leswawrHEKmiMYr7g=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.b8f12e2e21d0fce82f8d935f9cb80321fa3fca124fa36cc4df6e4b7474223741a777eb2b65f810cc333bd862f49543df61cf5607a0736faf053ffe9b9c39ff8a.js integrity="sha512-uPEuLiHQ/OgvjZNfnLgDIfo/yhJPo2zE325LdHQiN0Gnd+srZfgQzDM72GL0lUPfYc9WB6Bzb68FP/6bnDn/ig==" data-copy data-copied></script>
<script src=/js/zoom.min.js></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Azure Networking"><meta property="og:description" content="Network Interface # A single NIC can have multiple public and private IPs. Network Security Group (NSG) # NSG is stateful and contains inbound and outbound rules.
Service Tags are named groups that refer to Azure services (e."><meta property="og:type" content="article"><meta property="og:url" content="https://hugotkk.github.com/posts/azure-network/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-03T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-16T00:01:25+01:00"><meta property="og:site_name" content="Hugo's IT journal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Azure Networking"><meta name=twitter:description content="Network Interface # A single NIC can have multiple public and private IPs. Network Security Group (NSG) # NSG is stateful and contains inbound and outbound rules.
Service Tags are named groups that refer to Azure services (e."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Azure Networking","headline":"Azure Networking","abstract":"Network Interface # A single NIC can have multiple public and private IPs. Network Security Group (NSG) # NSG is stateful and contains inbound and outbound rules.\nService Tags are named groups that refer to Azure services (e.","inLanguage":"en","url":"https:\/\/hugotkk.github.com\/posts\/azure-network\/","author":{"@type":"Person","name":"Hugo"},"copyrightYear":"2024","dateCreated":"2024-07-03T00:00:00\u002b00:00","datePublished":"2024-07-03T00:00:00\u002b00:00","dateModified":"2024-07-16T00:01:25\u002b01:00","keywords":["azure","networking"],"mainEntityOfPage":"true","wordCount":"2266"}]</script><meta name=author content="Hugo"><link href=https://github.com/hugotkk rel=me><link href=https://linkedin.com/in/hugotkk rel=me><script src=/lib/jquery/jquery.slim.min.js integrity></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V270QWW7TE"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-V270QWW7TE")</script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div><a href=/ class=flex><span class=sr-only>Hugo&rsquo;s IT journal</span>
<img src=/image.jpg width=230 height=230 class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="Hugo's IT journal"></a></div><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">Hugo&rsquo;s IT journal</a></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Posts>Posts</p></a><a href=/tags/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Tags>Tags</p></a><a href=/tags/k8s/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=k8s>Kubernetes</p></a><a href=/tags/openstack/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=openstack>OpenStack</p></a><a href=/tags/aws/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=aws>AWS</p></a><a href=/tags/azure/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=azure>Azure</p></a><a href=/tags/rancher/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=rancher>Rancher</p></a><a href=/tags/docker/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=docker>Docker</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></nav><div class="flex md:hidden items-center space-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Posts>Posts</p></a></li><li class=mt-1><a href=/tags/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Tags>Tags</p></a></li><li class=mt-1><a href=/tags/k8s/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=k8s>Kubernetes</p></a></li><li class=mt-1><a href=/tags/openstack/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=openstack>OpenStack</p></a></li><li class=mt-1><a href=/tags/aws/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=aws>AWS</p></a></li><li class=mt-1><a href=/tags/azure/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=azure>Azure</p></a></li><li class=mt-1><a href=/tags/rancher/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=rancher>Rancher</p></a></li><li class=mt-1><a href=/tags/docker/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=docker>Docker</p></a></li></ul></div></label></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Azure Networking</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2024-07-03 00:00:00 +0000 UTC">3 July 2024</time><span class="px-2 text-primary-500">&#183;</span><time datetime="2024-07-16 00:01:25 +0100 +0100">Updated: 16 July 2024</time></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/azure/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">azure</span></span></span>
<span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/networking/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">networking</span></span></span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt=Hugo src=/image_hu41af6bbe385ae76f287135953fab8786_14628_192x192_fill_q75_box_smart1.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Hugo</div><div class="text-sm text-neutral-700 dark:text-neutral-400">DevOps Engineer in London</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/hugotkk target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://linkedin.com/in/hugotkk target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#network-interface>Network Interface</a></li><li><a href=#network-security-group-nsg>Network Security Group (NSG)</a></li><li><a href=#route-table>Route Table</a></li><li><a href=#subnet>Subnet</a></li><li><a href=#network-diagnose-tools>Network Diagnose Tools</a><ul><li><a href=#nsg-issue>NSG issue</a></li><li><a href=#connectivity-issue>Connectivity issue</a></li><li><a href=#connection-monitor>Connection monitor</a></li><li><a href=#flow-log>Flow Log</a></li></ul></li><li><a href=#private-link-in-azure-monitor>Private Link in Azure Monitor</a></li><li><a href=#app-service>App Service</a></li><li><a href=#azure-load-balancer>Azure Load Balancer</a><ul><li><a href=#nsg>NSG</a></li><li><a href=#nat-rules>NAT Rules</a></li><li><a href=#floating-ip>Floating IP</a></li><li><a href=#ha-port>HA Port</a></li><li><a href=#session-persistence>Session Persistence</a></li></ul></li><li><a href=#vm>VM</a></li><li><a href=#bastion>Bastion</a></li><li><a href=#expressroute>Expressroute</a></li><li><a href=#vnet-peering>VNET Peering</a></li><li><a href=#firewall>Firewall</a></li><li><a href=#service-endpoint>Service Endpoint</a></li><li><a href=#virtualwan>VirtualWAN</a></li><li><a href=#vpn>VPN</a><ul><li><a href=#s2s-vpn>S2S VPN</a></li><li><a href=#p2s-vpn>P2S VPN</a><ul><li><a href=#when-to-use>When to Use</a></li><li><a href=#authentication>Authentication</a></li><li><a href=#common-issue>Common issue</a></li></ul></li><li><a href=#vpn-types>VPN Types</a></li></ul></li><li><a href=#dns>DNS</a><ul><li><a href=#custom-domains>Custom Domains</a></li><li><a href=#zone-migration>Zone Migration</a></li><li><a href=#private-dns-zones>Private DNS Zones</a></li><li><a href=#custom-dns-server>Custom DNS Server</a></li><li><a href=#application-gateway>Application Gateway</a></li><li><a href=#traffic-manager>Traffic Manager</a></li><li><a href=#frontdoor>Frontdoor</a></li><li><a href=#api-management>API Management</a></li></ul></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#network-interface>Network Interface</a></li><li><a href=#network-security-group-nsg>Network Security Group (NSG)</a></li><li><a href=#route-table>Route Table</a></li><li><a href=#subnet>Subnet</a></li><li><a href=#network-diagnose-tools>Network Diagnose Tools</a><ul><li><a href=#nsg-issue>NSG issue</a></li><li><a href=#connectivity-issue>Connectivity issue</a></li><li><a href=#connection-monitor>Connection monitor</a></li><li><a href=#flow-log>Flow Log</a></li></ul></li><li><a href=#private-link-in-azure-monitor>Private Link in Azure Monitor</a></li><li><a href=#app-service>App Service</a></li><li><a href=#azure-load-balancer>Azure Load Balancer</a><ul><li><a href=#nsg>NSG</a></li><li><a href=#nat-rules>NAT Rules</a></li><li><a href=#floating-ip>Floating IP</a></li><li><a href=#ha-port>HA Port</a></li><li><a href=#session-persistence>Session Persistence</a></li></ul></li><li><a href=#vm>VM</a></li><li><a href=#bastion>Bastion</a></li><li><a href=#expressroute>Expressroute</a></li><li><a href=#vnet-peering>VNET Peering</a></li><li><a href=#firewall>Firewall</a></li><li><a href=#service-endpoint>Service Endpoint</a></li><li><a href=#virtualwan>VirtualWAN</a></li><li><a href=#vpn>VPN</a><ul><li><a href=#s2s-vpn>S2S VPN</a></li><li><a href=#p2s-vpn>P2S VPN</a><ul><li><a href=#when-to-use>When to Use</a></li><li><a href=#authentication>Authentication</a></li><li><a href=#common-issue>Common issue</a></li></ul></li><li><a href=#vpn-types>VPN Types</a></li></ul></li><li><a href=#dns>DNS</a><ul><li><a href=#custom-domains>Custom Domains</a></li><li><a href=#zone-migration>Zone Migration</a></li><li><a href=#private-dns-zones>Private DNS Zones</a></li><li><a href=#custom-dns-server>Custom DNS Server</a></li><li><a href=#application-gateway>Application Gateway</a></li><li><a href=#traffic-manager>Traffic Manager</a></li><li><a href=#frontdoor>Frontdoor</a></li><li><a href=#api-management>API Management</a></li></ul></li></ul></nav></div></details><script>var margin=200,marginError=50;(function(){var t=$(window),e=$("#TOCView"),s=e.height();function n(){var n=t.height()-margin;s>=n?(e.css("overflow-y","scroll"),e.css("max-height",n+marginError+"px")):(e.css("overflow-y","hidden"),e.css("max-height","9999999px"))}t.on("resize",n),$(document).ready(n)})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h2 class="relative group">Network Interface<div id=network-interface class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#network-interface aria-label=Anchor>#</a></span></h2><ul><li>A single NIC can have multiple public and private IPs.</li></ul><h2 class="relative group">Network Security Group (NSG)<div id=network-security-group-nsg class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#network-security-group-nsg aria-label=Anchor>#</a></span></h2><p>NSG is stateful and contains <code>inbound</code> and <code>outbound</code> rules.</p><p>Service Tags are named groups that refer to Azure services (e.g., AzurePortal, AzureLoadBalancer).</p><p>An NSG can be attached to:</p><ul><li>Subnets</li><li>Network Interfaces</li></ul><p>Order of NSG rules check:</p><ul><li>Inbound: Subnet > NIC</li><li>Outbound: NIC > Subnet</li></ul><p>A single NSG can be attached to multiple subnets or network interfaces.</p><p>By default, NSG allows:</p><ul><li>All traffic within the VNET.</li><li>Traffic from the load balancer.</li></ul><p>Additional points:</p><ul><li>Once traffic is denied, it is dropped.</li><li>If NSG is attached to both subnet and NIC, traffic must be allowed in both NSGs.</li><li>NSG must be in the same region as the VNET.</li></ul><p>To Check NSG for SSH Connectivity (e.g., Can VM1 SSH into VM2?)</p><ol><li>Identify Source and Destination:<ul><li>VM1 is the source.</li><li>VM2 is the destination.</li></ul></li><li>Check NSG Rules:<ul><li>For the source (VM1), look at the outbound rules.</li><li>For the destination (VM2), look at the inbound rules.</li></ul></li></ol><h2 class="relative group">Route Table<div id=route-table class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#route-table aria-label=Anchor>#</a></span></h2><p>Imagine we have VNETs A, B, and C that are peered together. VNET C acts as a network VNET to firewall, guard, and audit the network traffic. We want any egress public traffic from VNETs A and B to route through VNET C first.</p><p>To achieve this, we can add a route rule in the route tables of VNETs A and B with the address prefix <code>0.0.0.0/0</code>, next hop type set to <code>appliance</code>, and the next hop address set to the <code>appliance's address</code>.</p><p>If we want to route all VPN traffic through VNET C, we can set a route table rule at the <code>GatewaySubnet</code>.</p><h2 class="relative group">Subnet<div id=subnet class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#subnet aria-label=Anchor>#</a></span></h2><p>A subnet can have multiple address spaces, and additional address spaces can be added after the subnet has been created.</p><p>Azure reserves the first four and last IP addresses (5 in total) in each subnet.</p><p>The smallest subnet size in a VNet is /29.</p><h2 class="relative group">Network Diagnose Tools<div id=network-diagnose-tools class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#network-diagnose-tools aria-label=Anchor>#</a></span></h2><h3 class="relative group">NSG issue<div id=nsg-issue class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#nsg-issue aria-label=Anchor>#</a></span></h3><ul><li>IP Flow Verify (VM)</li><li>NSG Diagnostics (ScaleSet, NIC, Application Gateway)</li></ul><h3 class="relative group">Connectivity issue<div id=connectivity-issue class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#connectivity-issue aria-label=Anchor>#</a></span></h3><ul><li>Connection Troubleshoot (VMs, Bastion, and Application Gateway)</li></ul><h3 class="relative group">Connection monitor<div id=connection-monitor class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#connection-monitor aria-label=Anchor>#</a></span></h3><p>Connection Monitor is a regional service available in each Azure region.</p><p>It continuously checks connections over time.</p><p>To utilize Connection Monitor:</p><ul><li><strong>Azure VMs</strong>: Install the Network Watcher Agent.</li><li><strong>On-premises</strong>: Install the Azure Monitor Agent. Additionally, use the Azure Connected Machine agent to connect the VMs on Azure.</li></ul><p>This setup allows for proactive monitoring of connections, ensuring continuous visibility and troubleshooting capabilities across Azure environments and on-premises infrastructure.</p><h3 class="relative group">Flow Log<div id=flow-log class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#flow-log aria-label=Anchor>#</a></span></h3><p>Enabling Flow Log requires</p><ul><li>Storage Account</li><li>Register Insight Provider (At Subscription)</li></ul><p>Enabling Traffic Analytics requires</p><ul><li>Flow Log</li><li>Log Analytics Workspace</li></ul><h2 class="relative group">Private Link in Azure Monitor<div id=private-link-in-azure-monitor class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#private-link-in-azure-monitor aria-label=Anchor>#</a></span></h2><p>&ldquo;Monitor Private Link Scope&rdquo; refers to a collection of private links.</p><p>To use a private connection in Azure Monitor, it is necessary to establish private link connections because Azure Monitor integrates with various services. The &ldquo;Monitor Private Link Scope&rdquo; is essential for this purpose.</p><h2 class="relative group">App Service<div id=app-service class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#app-service aria-label=Anchor>#</a></span></h2><p>Integrating with a VNET provides egress connectivity to the VNET.</p><p>App Service will be assigned a private IP, which it uses to access services within the VNET.</p><p>However, this assignment is dynamic and can change during scaling operations.</p><p>Inbound traffic and internet traffic will still use the public IP.</p><p>NSGs / Firewall can be utilized to control the App Service traffic flow into the VNET.</p><h2 class="relative group">Azure Load Balancer<div id=azure-load-balancer class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#azure-load-balancer aria-label=Anchor>#</a></span></h2><p>The SKU of the Load Balancer must match that of the public IP:</p><ul><li>Standard public IP addresses must be used with Standard Load Balancers.</li><li>Basic public IP addresses are compatible only with scale sets or availability sets.</li></ul><p>To create the load balancer, a <code>frontend IP</code> is required.</p><p>To set up the load balancing rule, a <code>backend pool</code> and a <code>health probe</code> need to be configured.</p><p>The load balancer and VMs need to be in the same VNET.</p><h3 class="relative group">NSG<div id=nsg class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#nsg aria-label=Anchor>#</a></span></h3><p>Traffic originating from the LB always appears to come from 168.63.129.16.</p><p>When VMs are behind the LB, NSG rules must explicitly specify the source as 168.63.129.16 to allow traffic.</p><p>By default, traffic from 168.63.129.16 (Serivce Tag: AzureLoadBalancer) is allowed, so NSG rules are typically used to deny traffic.</p><h3 class="relative group">NAT Rules<div id=nat-rules class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#nat-rules aria-label=Anchor>#</a></span></h3><p>Load Balancer are used for distributing traffic. Interestingly, in Azure, they can also act as a NAT.</p><p><strong>Inbound NAT Rule:</strong></p><ul><li>Allows the outside network to reach the backend point or VMs behind the backend pool</li><li>To connect to VM1 and VM2 via the Load Balancer on same port, we need 2 frontend IPs:<ul><li><code>&lt;frontend_ip1>:8080 -> VM1:8080</code></li><li><code>&lt;frontend_ip2>:8080 -> VM2:8080</code></li></ul></li><li>Frontend IPs can be mapped to a backend pool using a single frontend IP, where the frontend IP starts with a base port that increments for each mapping:<ul><li><code>&lt;frontend_ip1>:8081 -> VM1:8080</code></li><li><code>&lt;frontend_ip1>:8082 -> VM2:8080</code></li><li><code>&lt;frontend_ip1>:X -> VMX:8080</code></li></ul></li></ul><p><strong>Outbound Rules:</strong></p><ul><li>Multiple VMs in the backend pool can share a single frontend IP for outbound traffic.</li></ul><h3 class="relative group">Floating IP<div id=floating-ip class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#floating-ip aria-label=Anchor>#</a></span></h3><ul><li><strong>Disabled:</strong> Traffic routes through the load balancer to the VM&rsquo;s IP.</li><li><strong>Enabled:</strong> Traffic routes through the load balancer to the VM&rsquo;s Floating IP (FIP).</li></ul><p>In an on-premise Active-Passive HA setup, a VIP is typically used, to which clients always connect. Monitoring tools check server health and shift the VIP between active and passive instances. The VM will respond to ARP requests for the VIP when it holds it.</p><p>In the cloud, ARP and other broadcast messages are not permitted, necessitating the use of a load balancer.</p><p>To set up a Floating IP in Linux:</p><ul><li>Basically, create a loopback interface with the Floating IP.</li></ul><p>This setup is commonly used to achieve High Availability in SQL Server, where a Floating IP is needed for direct server return.</p><h3 class="relative group">HA Port<div id=ha-port class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ha-port aria-label=Anchor>#</a></span></h3><p>Configuration: Set port to 0 and protocol to all in the load balancing rule. This directs all ports and protocols to the VM directly</p><p>Due to this, each floating IP can only have 1 load balancer rule and connect to 1 backend.</p><p>This feature is for:</p><ul><li><strong>Internal Load Balancer</strong> only</li><li><strong>Standard tier</strong> only</li></ul><p><strong>Use Case: Virtual Appliance (eg: Firewall):</strong></p><ul><li>Configure two floating IPs and HA ports on the virtual appliance to tag traffic from different services.</li><li>HA port is also required to inspect traffic for any protocol and any port.</li><li>Floating IP is necessary for HA and to distinguish the traffic from different service, such as:<ul><li>Route all Web Server subnet traffic to FIP1.</li><li>Route all DB subnet traffic to FIP2.</li></ul></li><li>Requests are first forwarded to the virtual appliance (acting as a man in the middle) before being sent to the destination.</li></ul><h3 class="relative group">Session Persistence<div id=session-persistence class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#session-persistence aria-label=Anchor>#</a></span></h3><p>Session Persistence based on Client IP ensures that traffic from the same client is always served by the same VM.</p><h2 class="relative group">VM<div id=vm class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#vm aria-label=Anchor>#</a></span></h2><p>A VM without a public IP can still access the internet.</p><p>For a VM with standard public IP:</p><ul><li>Security settings enforce blocking all traffic by default. You must attach a NSG to allow traffic into the VM.</li></ul><p>For a VM with basic public IP:</p><ul><li>The VM is accessible publicly without needing an NSG attached.</li></ul><p>A VM can change its subnet or NIC but not its VNET. To change the VNET or move the VM to another region, we need to recreate the VM.</p><h2 class="relative group">Bastion<div id=bastion class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#bastion aria-label=Anchor>#</a></span></h2><ul><li><p>Bastion must be deployed to a subnet named AzureBastionSubnet.</p></li><li><p>The subnet must be /26 or larger.</p></li><li><p>Bastion protects VMs only.</p></li><li><p>Basic SKU:</p><ul><li>Creates 2 instances.</li></ul></li><li><p>Standard SKU:</p><ul><li>Allows specifying the number of instances (host scaling).</li><li>Supports file upload/download.</li><li>Supports native client (use Azure CLI for SSH/RDP connections).</li></ul></li></ul><p>Public IP requirements:</p><ul><li>Can be regional or global (to be confirmed).</li><li>Must be static.</li><li>Requires Standard SKU.</li></ul><p>Without the native client, we can only use Bastion through the Azure portal.</p><p>Each instance supports up to 20 RDP or 40 SSH connections.</p><p>For example, with 100 concurrent SSH connections, we need 3 instances, which means we need the Standard Bastion SKU and host scaling set to 3.</p><p>Resizing the subnet is unnecessary since we only need additional instances.</p><h2 class="relative group">Expressroute<div id=expressroute class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#expressroute aria-label=Anchor>#</a></span></h2><ul><li>The Basic SKU does not support the coexistence of VPN Gateway and ExpressRoute.</li><li>The ErGw3Az SKU supports FastPath.</li></ul><h2 class="relative group">VNET Peering<div id=vnet-peering class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#vnet-peering aria-label=Anchor>#</a></span></h2><p>With VNET Peering, the VNET address spaces must not overlap.</p><p>When peering is disconnected, we need to recreate the peering connections.</p><p>When transit routing is enabled in a VNET, traffic can transit through it to reach other VNETs.</p><p>For example, if we have VNET1, VNET2, and VNET3:</p><ul><li>Initially, VNET1 cannot access VNET3.</li><li>If transit routing is enabled in VNET2, VNET1 can access VNET3 through VNET2.</li></ul><p>One key difference between S2S VPN and VNET Peering is that VNET Peering does not require creating an extra GatewaySubnet to connect two VNETs.</p><h2 class="relative group">Firewall<div id=firewall class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#firewall aria-label=Anchor>#</a></span></h2><p>Firewall Premium supports public IP with:</p><ul><li>Standard SKU</li><li>Global & Regional? (to be confirmed)</li><li>IPv4 Only</li></ul><p>Policy:</p><ul><li>Parent policies are often used to enforce organization-wide security standards.</li><li>Child policies allow for environment-specific or application-specific rules.</li><li>Rules in child policies take precedence over rules in the parent policy.</li><li>Parent and child policies need to be in the same region.</li></ul><p>The region of the firewall should be the same as the region of the VNET.</p><p>In App Service, to control outbound traffic with a firewall, we need to enable VNET integration and then create a user-defined route table to route all traffic to the firewall.</p><h2 class="relative group">Service Endpoint<div id=service-endpoint class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#service-endpoint aria-label=Anchor>#</a></span></h2><p>Service Endpoints use private IP addresses to access Azure services, simplifying access control with ACLs.</p><p>VNET and Service Endpoint must be in the same region.</p><p>It is in the Subnet level.</p><h2 class="relative group">VirtualWAN<div id=virtualwan class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#virtualwan aria-label=Anchor>#</a></span></h2><p>Virtual WAN (similar to AWS Transit Gateway) is a global resource that can span across regions, while Virtual Hubs are regional resources.</p><p>Single Virtual WAN can connect to multiple Virtual Hubs.</p><p>Basic VirtualWAN has limited functionality compare to the standard tier:</p><ul><li>Only support S2S VPN</li><li>Does not support ExpressRoute connections</li><li>Does not support P2P connections</li></ul><p>To create a S2S VPN between a branch and a VNET:</p><ol><li>Create a Virtual WAN.</li><li>Create a Virtual Hub.</li><li>Create a VPN site in the Virtual Hub.</li><li>Connect the VPN site to the Hub.</li><li>Connect the VNET to the Hub.</li></ol><h2 class="relative group">VPN<div id=vpn class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#vpn aria-label=Anchor>#</a></span></h2><h3 class="relative group">S2S VPN<div id=s2s-vpn class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#s2s-vpn aria-label=Anchor>#</a></span></h3><p>The Basic SKU VPN Gateway does not support coexistence with ExpressRoute for S2S VPN.</p><p><strong>Steps to Create a S2S VPN</strong></p><ol><li>Create a gateway subnet.</li><li>Create a VPN gateway.</li><li>Create a local gateway (representing the on-premise site).</li><li>Create a VPN connection.</li></ol><p>Each VPN gateway can support 2 connections for failover, requiring 2 local gateways (for 2 on-premise routers) and using up 2 public IP addresses for the gateway.</p><ul><li><strong>IKEv2</strong> supports up to 10 S2S connections.</li><li><strong>IKEv1</strong> supports only 1 S2S connection.</li></ul><p>IKEv2 is necessary if redundancy is required.</p><h3 class="relative group">P2S VPN<div id=p2s-vpn class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#p2s-vpn aria-label=Anchor>#</a></span></h3><h4 class="relative group">When to Use<div id=when-to-use class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#when-to-use aria-label=Anchor>#</a></span></h4><ul><li><strong>P2S VPN:</strong> Suitable for remote workers, as the IP addresses connecting to the VNET can vary.</li><li><strong>S2S VPN:</strong> Suitable for branch offices, connecting on-premise networks to the VNET with fixed IPs.</li></ul><h4 class="relative group">Authentication<div id=authentication class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#authentication aria-label=Anchor>#</a></span></h4><p>P2S VPN can authenticate using</p><ul><li>certificate authentication</li><li>Active Directory</li></ul><p><strong>To setup Certificate Authentication:</strong></p><ol><li>Generate a CA and client certifcate.</li><li>Upload the CA public key to the P2S VPN Setting.</li><li>Connect to the VPN using client certifcate.</li></ol><h4 class="relative group">Common issue<div id=common-issue class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#common-issue aria-label=Anchor>#</a></span></h4><ol><li>The on-premise network is connected to VNET A via a S2S VPN.</li><li>Clients connect to VNET A using a P2S VPN.</li><li>VNET A is peered with VNET B.</li></ol><p>P2S VPN clients may fail to access VNET B when the network topology changes, necessitating a reinstall or restart of the VPN client.</p><p>In this setup, the client cannot access VNET B, while the on-premise network can, indicating this issue.</p><h3 class="relative group">VPN Types<div id=vpn-types class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#vpn-types aria-label=Anchor>#</a></span></h3><ul><li><strong>Route-based VPN:</strong> Used for large networks; uses a route table.</li><li><strong>Policy-based VPN:</strong> Used for small networks; uses ACLs, requiring specific source and destination addresses.</li></ul><p>Since usually P2S VPN clients do not have fixed IPs, it is difficult to use ACLs (as the source cannot be specified). Therefore, route-based VPN is usually used for P2S VPNs.
Certainly! Here&rsquo;s a rewritten version:</p><h2 class="relative group">DNS<div id=dns class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#dns aria-label=Anchor>#</a></span></h2><p>DNS settings can be configured at the</p><ul><li>VNET</li><li>NIC</li></ul><p>We can either use custom DNS or Azure DNS.</p><p>To use custom DNS, we can</p><ul><li>Deploy DNS server in VNET</li><li>Config DNS server to forward Azure Domain to Azure DNS (168.63.129.16). This ensures that Azure related names can be resolved correctly.</li><li>Config the DNS setting at VNET / NIC with the custom DNS server IP</li></ul><h3 class="relative group">Custom Domains<div id=custom-domains class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#custom-domains aria-label=Anchor>#</a></span></h3><ol><li>Update NS records at your domain registrar.</li><li>Verify domain ownership using a TXT record.</li><li>Configure your custom domain with a CNAME or A record.</li></ol><h3 class="relative group">Zone Migration<div id=zone-migration class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#zone-migration aria-label=Anchor>#</a></span></h3><p>Azure offers PowerShell scripts to facilitate DNS zone migration, useful for transitioning from on-premises or other cloud providers.</p><h3 class="relative group">Private DNS Zones<div id=private-dns-zones class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#private-dns-zones aria-label=Anchor>#</a></span></h3><ul><li>Private DNS zones are necessary for connecting with Virtual Networks (VNETs).</li><li>One DNS zone can be connected to multiple VNETs, and multiple resolution zones can be linked to a single VNET.</li><li>Auto-registration automated the creation of DNS records for linked VNETs.</li><li>Auto-registration is only supported within private DNS zones.</li><li>Each VNET can designate one registration zone with auto-registration enabled.</li></ul><h3 class="relative group">Custom DNS Server<div id=custom-dns-server class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#custom-dns-server aria-label=Anchor>#</a></span></h3><ul><li>Virtual Machines (VMs) can function as custom DNS servers.</li><li>Each VNET can opt for Azure DNS or a custom DNS setup.</li><li>Ensure connectivity to the VM when using it as a DNS server.</li></ul><h3 class="relative group">Application Gateway<div id=application-gateway class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#application-gateway aria-label=Anchor>#</a></span></h3><ul><li>similar to AWS&rsquo;s ALB</li><li>Level 7 Application Load Balancer</li><li>Regional Service</li></ul><h3 class="relative group">Traffic Manager<div id=traffic-manager class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#traffic-manager aria-label=Anchor>#</a></span></h3><ul><li>DNS-based traffic routing service</li><li>Global service, not tied to a specific region</li><li>Can handle regional outages by redirecting traffic to healthy endpoints</li><li>Premium version offers additional features for private networking and security</li></ul><h3 class="relative group">Frontdoor<div id=frontdoor class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#frontdoor aria-label=Anchor>#</a></span></h3><ul><li>Similar to AWS CloudFront</li><li>Global service, not tied to a specific region</li><li>Rate limiting can be implemented using Frontdoor (Premium) and WAF</li><li>Can terminate SSL certificates, similar to Application Gateway</li></ul><h3 class="relative group">API Management<div id=api-management class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#api-management aria-label=Anchor>#</a></span></h3><ul><li>Similar to AWS API Gateway</li></ul></div></div><script>var oid="views_posts/azure-network.md",oid_likes="likes_posts/azure-network.md"</script><script type=text/javascript src=/js/page.min.b06a29d42a4ed16787978e2eee1e8c797b7698db2bc14ccee78f5c80ac566fc996190a73ad80a5e987558474b20b96fa38f7d85b405f165ff72b7b163c5ad11b.js integrity="sha512-sGop1CpO0WeHl44u7h6MeXt2mNsrwUzO549cgKxWb8mWGQpzrYCl6YdVhHSyC5b6OPfYW0BfFl/3K3sWPFrRGw=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/azure-acl/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Azure ACL</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2024-06-29 00:00:00 +0000 UTC">29 June 2024</time></span></span></a></span>
<span><a class="flex text-right group ml-3" href=/posts/azure-resource-group/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Azure Resource Group</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2024-07-06 00:00:00 +0000 UTC">6 July 2024</time></span></span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><div id=disqus_thread></div><script>(function(){var e=document,t=e.createElement("script");t.src="https://hugotkk-github-io.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></footer></article></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/posts/ title=Posts>Articles</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/tags/ title=Tags>Tags</a></li></ul></nav><div class="flex items-center justify-between"></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.62060bb247f4de2b6dde45903668fefb68d792f365587605177b1227c0cf43588701edaca0cb40e2c8e2789bd5ce67c1d2a215b9fb258c3496a7cd25e7cb5fdf.js integrity="sha512-YgYLskf03itt3kWQNmj++2jXkvNlWHYFF3sSJ8DPQ1iHAe2soMtA4sjieJvVzmfB0qIVufsljDSWp80l58tf3w=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://hugotkk.github.com/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>